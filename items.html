<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Items</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
			integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
			crossorigin="anonymous"
		/>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
			crossorigin="anonymous"
		></script>
		<script src="https://d3js.org/d3.v7.min.js"></script>
	</head>

	<body style="text-align: center; margin-top: 2%;">
		<h2>Liste des items</h2>
		<div class="container-sm" style="margin-top: 5%">
			<table class="table table-bordered">
				<thead>
					<tr>
						<th scope="col">Identifiant</th>
						<th scope="col">Titre</th>
						<th scope="col">Média</th>
					</tr>
				</thead>
				<tbody id="items_tbody">
				</tbody>
			</table>
		</div>
	</body>
	<script>
		let global_var = {
			base_url: "https://polemika.univ-paris8.fr/omk/api/items",
		};

		function getData() {
			d3.json(global_var.base_url)
				.then((res) => {
					if (res != null && res.length > 0) {
						showItems(res);
					} else {
						console.log("getData_error");
					}
				})
				.catch((e) => {
					throw e;
				});
		}

		function showItems(data) {
			let where_append = document.getElementById("items_tbody");
			let html = "";
			for (let i1 = 0; i1 < data.length; i1++) {
				let item = data[i1];
				html += "<tr>";
				if (item["o:id"] != null) {
					html += "<th scope='row'>" + item["o:id"] + "</th>";
				} else {
					html += "<th scope='row'>Non renseigné</th>";
				}
				if (item["o:title"] != null) {
					html += "<td>" + item["o:title"] + "</td>";
				} else {
					html += "<td>Non renseigné</td>";
				}
				if (item["o:media"] != null && item["o:media"].length > 0) {
					html += "<td id='media" + item["o:id"] + "'></td>";

					for (let i2 = 0; i2 < item["o:media"].length; i2++) {
						let media = item["o:media"][i2];
						if (media["@id"] != null) {
							d3.json(media["@id"]).then((res) => {
								if (res != null) {
									document.getElementById("media" + item["o:id"]).innerHTML += "<img style='width: 20%;' src='" + res["o:thumbnail_urls"].square + "' /> </br>";
								} else {
                                    document.getElementById("media" + item["o:id"]).innerHTML += "URL non trouvée";
                                }
							});
						}
					}
				} else {
					html += "<td>Non renseigné</td>";
				}
				html += "</tr>";
			}

			if (where_append != null) {
				where_append.innerHTML = html;
			}
		}

		window.onload = function () {
			getData();
		};
	</script>
</html>
